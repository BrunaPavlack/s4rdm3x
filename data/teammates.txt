//load_jar data/teammates.jar

//clear_graph
load_jar data/teammatesV5.110.jar

add_node_tag test pkg:teammates/test/
//add_edges test_pkg 16 tag:test
hide tag:test

add_node_tag ui pkg:teammates/ui/
add_node_tag ui.view pkg:teammates/ui/datatransfer/ OR pkg:teammates/ui/pagedata/ OR pkg:teammates/ui/template/
add_node_tag ui.automated pkg:teammates/ui/automated/
add_node_tag ui.controller pkg:teammates/ui/controller/
set_attr ui.style fill-color:rgb(149,179,215); tag:ui

add_edges gui_view_pkg,pkg 32 tag:ui.view
add_edges gui_automated_pkg,pkg 32 tag:ui.automated
add_edges gui_controller_pkg,pkg 32 tag:ui.controller
add_edges gui_pkg,pkg 36 tag:gui_view_pkg OR tag:gui_automated_pkg OR tag:gui_controller_pkg
//contract tag:pkg


add_node_tag logic pkg:teammates/logic/
add_node_tag logic.core pkg:teammates/logic/core/
add_node_tag logic.core.facade pkg:teammates/logic/api/
add_node_tag logic.backdoor pkg:teammates/logic/backdoor/
set_attr ui.style fill-color:rgb(179,162,199); tag:logic

add_node_tag storage pkg:teammates/storage/
add_node_tag storage.entity pkg:teammates/storage/entity/
add_node_tag storage.api pkg:teammates/storage/api/
add_node_tag storage.search pkg:teammates/storage/search/
set_attr ui.style fill-color:rgb(195,214,155); tag:storage

add_node_tag common pkg:teammates/common/
add_node_tag common.util pkg:teammates/common/util/
add_node_tag common.exception pkg:teammates/common/exception/
add_node_tag common.datatransfer pkg:teammates/common/datatransfer/
set_attr ui.style fill-color:rgb(53,100,174); tag:common

hide NOT(tag:ui OR tag:common OR tag:storage OR tag:logic OR tag:pkg)

add_edges common_util_pkg,pkg 24 tag:common.util
add_edges common_dt_pkg,pkg 24 tag:common.datatransfer
add_edges common_ex_pkg,pkg 24 tag:common.exception
add_edges common_pkg,pkg 56 tag:common_util_pkg OR tag:common_dt_pkg OR tag:common_ex_pkg

add_edges logic_core_facade_pkg,pkg 12 tag:logic.core.facade
add_edges logic_core_pkg,pkg 24 tag:logic.core OR tag:logic_core_facade_pkg
add_edges logic_backdoor_pkg,pkg 12 tag:logic.backdoor
add_edges logic_pkg,pkg 46 tag:logic_core_pkg OR tag:logic_backdoor_pkg


add_edges storage_api_pkg,pkg 24 tag:storage.api
add_edges storage_entity_pkg,pkg 24 tag:storage.entity
add_edges storage_search_pkg,pkg 24 tag:storage.search
add_edges storage_pkg,pkg 64 tag:storage_api_pkg OR tag:storage_entity_pkg OR tag:storage_search_pkg

add_node_tag appengine pkg:/googlecode/objectify/
set_attr ui.style fill-color:rgb(191,191,191); tag:appengine
add_edges appengine_pkg,pkg 16 tag:appengine

// no one in ui should use the backdoor
//add_relations violation 32 tag:ui|pkg:/logic/backdoor/

//add_relations violation 32 pkg:/storage/entitiy/|pkg:/storage/api

// common should not use anything
add_relations violation 16 tag:common|tag:ui
add_relations violation 16 tag:common|tag:logic
add_relations violation 16 tag:common|(tag:storage AND NOT(tag:storage.entity))
add_relations violation 16 tag:common|tag:appengine

// logic 
add_relations violation 16 tag:logic|tag:ui
add_relations violation 16 tag:logic|tag:storage.entity
add_relations violation 16 tag:logic|tag:storage.search
add_relations violation 16 tag:logic|tag:appengine
add_relations violation 16 tag:core|tag:logic.core.facade
add_relations violation 16 tag:core|tag:logic.backdoor
add_relations violation 16 tag:core.facade|tag:logic.backdoor
add_relations violation 16 tag:core.facade|tag:storage

// storage
add_relations violation 16 tag:storage|tag:ui
add_relations violation 16 tag:storage|tag:logic
add_relations violation 16 (tag:storage AND NOT(tag:storage.api)|tag:logic
add_relations violation 16 tag:storage.entity|tag:storage.api
add_relations violation 16 tag:storage.entity|tag:storage.search

// ui
add_relations violation 16 tag:ui|tag:storage
add_relations violation 16 tag:ui|tag:logic.backdoor
add_relations violation 16 tag:ui|(tag:logic.core AND NOT(tag:logic.core.facade))
add_relations violation 16 tag:ui.view|tag:ui.automated
add_relations violation 16 tag:ui.view|tag:ui.controller
add_relations violation 16 tag:ui.view|tag:logic
add_relations violation 16 tag:ui.automated|tag:ui.view
add_relations violation 16 tag:ui|tag:appengine

//hide NOT(edgTo:violation)

contract tag:gui_controller_pkg
contract tag:gui_view_pkg
expand tag:gui_controller_pkg
